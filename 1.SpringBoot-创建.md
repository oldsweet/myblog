

# 1.SpringBoot-创建

1. web启动器

   ```xml
   <!--        导入web依赖-->
           <dependency>
               <groupId>org.springframework.boot</groupId>
               <artifactId>spring-boot-starter-web</artifactId>
           </dependency>
   ```

   

2. 控制器的模板

   ```java
   package com.usc.controller;
   
   import org.springframework.stereotype.Controller;
   import org.springframework.web.bind.annotation.GetMapping;
   import org.springframework.web.bind.annotation.RequestMapping;
   import org.springframework.web.bind.annotation.ResponseBody;
   
   @Controller
   @RequestMapping("/hello")
   public class HelloController {
       @GetMapping("/hello")
       @ResponseBody
       public String hello(){
           return "helloworld";
       }
   }  
   
   ```

3. 修改配置

   - application.properties 中设置sever.port，配置端口号
   - 在resource下可以设置banner

# 2.SpringBoot-原理初探

启动器

- 启动器选择了spring应用程序的应用场景

```xml
		<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter</artifactId>
        </dependency>

```

主程序

```java
package com.usc;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication // 标注这个类是一个springboot的程序
public class Springboot01HelloworldApplication {

    public static void main(String[] args)
    {
        // 将springboot应用启动
        SpringApplication.run(Springboot01HelloworldApplication.class, args);
        System.out.println("hello world");
    }

}

```

注解

... 

# 3.SpringBoot的配置

- 官方推荐使用application.yaml

  ![image-20210622144514068](D:\我的博客\博客\image-20210622144514068.png)

- yaml可以注入到配置类中

  ```xml
          <!-- 自定义的元数据依赖 -->
  <dependency>
     <groupId>org.springframework.boot</groupId>
     <artifactId>spring-boot-configuration-processor</artifactId>
     <optional>true</optional>
  </dependency>
  ```

  ```xml
  # yaml 的配置 这里可以使用松散装配
  person:
    name: libaisonm
    age: 10
  ```

  

  ```java
  class Springboot01HelloworldApplicationTests {
      // 这里需要进行主动装配
      @Autowired
      private person per;
      @Test
      void contextLoads() {
          System.out.println(per);
      }
  
  }
  ```

  ```
  person{name='libaisonm', age=10}
  // 结果
  ```

  

- JSR303校验

  - spring-boot中可以用@validat来校验数据，如果数据异常则会统一抛出异常，方便异常中心统一处理。

- 多环境配置

  ![image-20210622192553608](D:\我的博客\博客\image-20210622192553608.png)

  可以有一个主文件来指定一个使用的配置文件

  ![image-20210622192629681](D:\我的博客\博客\image-20210622192629681.png)

  指定使用test的配置环境

  ![image-20210622192652870](D:\我的博客\博客\image-20210622192652870.png)

  

# 4.SpringBoot Web开发

- jar -> webapp

- 自动装配XXXAutoConfiguration..向容器中自动配置组件

- xxxProperties:自动配置类，装配配置文件中自定义的一些内容

- 要解决的问题

  - 导入静态资源
  - 首页
  - jsp，模板引擎Thymeleaf
  - 装配拓展SpringMVC

- webjars：

  ![image-20210622215046987](D:\我的博客\博客\image-20210622215046987.png)

  ```xml
  <!--    导入webjars    -->
          <dependency>
              <groupId>org.webjars</groupId>
              <artifactId>jquery</artifactId>
              <version>3.6.0</version>
          </dependency>
      </dependencies>
  ```

- 使用resources的public，resources，static 优先级 resources > static > public

- 首页的定制：在上述的文件夹中添加index.html就可以实现首页的配置

- themeleaf

  ```xml
  <!--        导入thymeleaf-->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-thymeleaf</artifactId>
          </dependency>
  ```

  ![image-20210622223027858](D:\我的博客\博客\image-20210622223027858.png)

  

![image-20210622223112980](D:\我的博客\博客\image-20210622223112980.png)

## 4.1 themeleaf 的使用

- themeleaf的基本模板

```html
<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<body>
<!--所有的html元素都可以被thymeleaf接管-->
<!--取数据-->
<h1 th:text=" ${msg}"></h1>

</body>
</html>
```

## 4.2 装配SpringMVC

# 5.SpringBoot整合其他框架

## 5.1 整合redis

- 导入依赖

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```

![image-20210623083226807](D:\我的博客\博客\image-20210623083226807.png)

![image-20210623083455909](D:\我的博客\博客\image-20210623083455909.png)

## 5.1 整合mybaties

- 导入依赖

```xml
<!--        mybaties的依赖导入-->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>2.2.0</version>
        </dependency>
```

- yml配置datasource

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    password: Aa010326.
    url: jdbc:mysql://127.0.0.1:3306/classbegin?useUnicode=true&characterEncoding=utf-8&useJDBCCompliantTimezoneShift=true&useLegacyDatetimeCode=false&serverTimezone=UTC
    username: root

```

- mapper模板

```java
package com.example.mapper;

import com.example.domain.Student;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;

import java.util.List;

@Mapper
public interface UserMapper {
    @Select("select * from student")
    public List<Student> findAll();
}
```

# 6.SpringBoot高级

## 6.1 condition

- condition可以选择性的创建Bean

- 获取ioc和bean

  ```java
  package com.example;
  
  import org.springframework.boot.SpringApplication;
  import org.springframework.boot.autoconfigure.SpringBootApplication;
  import org.springframework.context.ConfigurableApplicationContext;
  
  @SpringBootApplication
  public class SpringbootConditionApplication {
  
      public static void main(String[] args) {
          // 获取io容器
          ConfigurableApplicationContext context = SpringApplication.run(SpringbootConditionApplication.class, args);
          // 获取相对应的bean
          Object template = context.getBean("redisTemplate");
          System.out.println(template);
      }
  
  }
  ```

# 7.SpringBoot监听器

- SpringBoot的监听机制，其实就是对java提供的时间监听机制的封装

- java中的监听机制定义了以下及格角色：

  - 事件：event，继承java.util.EventObject
  - 事件源：source,任意对象Object
  - 监听器：Listener,实现java.util.EventLister接口的对象

- ApplicationContextInitializer

  ```java
  package com.example.listener;
  
  import org.springframework.context.ApplicationContextInitializer;
  import org.springframework.context.ConfigurableApplicationContext;
  
  public class Initializer implements ApplicationContextInitializer {
      @Override
      public void initialize(ConfigurableApplicationContext configurableApplicationContext) {
          // 这里实现了initilizer的逻辑代码
          
      }
  }
  
  ```

- SpringApplicationRunListener

  ```java
  package com.example.listener;
  
  
  import org.springframework.boot.ConfigurableBootstrapContext;
  import org.springframework.boot.SpringApplicationRunListener;
  import org.springframework.context.ConfigurableApplicationContext;
  import org.springframework.core.env.ConfigurableEnvironment;
  
  public class RunListener implements SpringApplicationRunListener {
  
      @Override
      public void starting(ConfigurableBootstrapContext bootstrapContext) {
          // 启动
      }
  
      @Override
      public void starting() {
  
      }
  
      @Override
      public void environmentPrepared(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment) {
  
      }
  
      @Override
      public void environmentPrepared(ConfigurableEnvironment environment) {
  
      }
  
      @Override
      public void contextPrepared(ConfigurableApplicationContext context) {
  
      }
  
      @Override
      public void contextLoaded(ConfigurableApplicationContext context) {
  
      }
  
      @Override
      public void started(ConfigurableApplicationContext context) {
  
      }
  
      @Override
      public void running(ConfigurableApplicationContext context) {
  
      }
  
      @Override
      public void failed(ConfigurableApplicationContext context, Throwable exception) {
  		// 启动失败
      }
  }
  
  ```

- CommandLineRunner

  ```java
  package com.example.listener;
  
  import org.springframework.boot.CommandLineRunner;
  
  public class CommandRunner implements CommandLineRunner {
      public CommandRunner() {
          super();
      }
  
      @Override
      public void run(String... args) throws Exception {
          System.out.println("CommandLineRunner....run");
      }
  }
  
  ```



# 8.SpringBoot流程分析

# 9.SpringBoot监控

- SpringBoot自带的监控actuator

  ```xml
   <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-actuator</artifactId>
  </dependency>
  
  ```

- actuator管理

  ```yaml
  # 开启健康检查的详情
  management.endpoint.health.show-details=always
  
  # 暴露所有的监控
  management.endpoints.web.exposure.include=*
  ```

# 10.SpringBoot部署

- 配置maven插件

  ```xml
     	<plugin>
                  <groupId>org.apache.maven.plugins</groupId>
                  <artifactId>maven-resources-plugin</artifactId>
          <version>2.4.3</version>
  </plugin>
  ```

- package操作（默认为jar包）

- java -jar  (jar包的打包路径)

- 打war包

  ```java
  package com.usc;
  
  import org.springframework.boot.SpringApplication;
  import org.springframework.boot.autoconfigure.SpringBootApplication;
  import org.springframework.boot.builder.SpringApplicationBuilder;
  import org.springframework.boot.web.servlet.support.SpringBootServletInitializer;
  
  @SpringBootApplication
  public class SpringbootActuatorApplication extends SpringBootServletInitializer {
  
      public static void main(String[] args) {
          SpringApplication.run(SpringbootActuatorApplication.class, args);
      }
  
      @Override
      protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) {
          return builder.sources(SpringbootActuatorApplication.class);
      }
  }
  ```

  ```xml
   <packaging>war</packaging>
  ```

  